# 上传简历后文件列表未清空问题修复计划

## 问题现象

在 `http://localhost:3000/#/upload` 页面上传简历并开始筛选后，上传简历的那一栏（文件列表）没有清空，仍然显示已选择的文件。

## 问题根因分析

### 代码流程追踪

1. **文件选择流程** (`upload.js`)
   - `handleFilesSelect()` → 将文件存入 `this.uploadedFiles` 数组
   - `showFileList()` → 隐藏上传区域，显示文件列表

2. **提交筛选流程** (`submitScreening()` 方法，第 925-977 行)
   ```javascript
   async submitScreening() {
       // 显示进度容器
       // 重置进度 UI
       // 调用 talentsApi.batchUpload() 上传文件
       // 如果成功，设置 currentTaskId 并订阅任务更新
       // ❌ 问题：没有清空 uploadedFiles 数组
       // ❌ 问题：没有重置文件输入框
       // ❌ 问题：没有隐藏文件列表区域
   }
   ```

3. **对比 `clearAllFiles()` 方法**（第 884-903 行）
   - 该方法正确地清空了所有状态
   - 但只在用户手动点击"清空全部"或"继续上传"时调用

### 根本原因

**`submitScreening()` 方法在成功提交筛选任务后，没有清空上传状态**：
- `this.uploadedFiles` 数组未被清空
- 文件输入框 `fileInput.value` 未被重置
- 文件列表区域未被隐藏
- 上传区域未被重新显示

### 预期行为

用户提交筛选任务后，应该：
1. 清空已上传的文件列表
2. 重置文件输入框
3. 恢复上传区域的初始状态（显示上传框，隐藏文件列表）
4. 用户可以继续上传新的简历文件

## 解决方案

### 方案一：提交成功后立即清空（推荐）

在 `submitScreening()` 方法中，当任务成功创建后，立即清空上传状态：

**修改位置**：`frontend-new/js/pages/upload.js` 第 956-968 行

**修改内容**：
```javascript
if (response.success) {
    this.currentTaskId = response.data.task_id;
    this.saveTaskId(this.currentTaskId);
    
    // ✅ 新增：清空上传状态
    this.uploadedFiles = [];
    const fileInput = document.getElementById('fileInput');
    if (fileInput) fileInput.value = '';
    
    // 订阅任务更新
    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
        this.ws.send(JSON.stringify({
            type: 'subscribe',
            task_id: this.currentTaskId
        }));
    }
    
    UI.toast(`上传任务已创建，共 ${response.data.file_count} 个文件`, 'success');
} else {
    UI.toast(response.message || '上传失败', 'error');
}
```

**优点**：
- 用户可以立即开始上传新的文件
- 不影响正在进行的任务进度显示
- 逻辑清晰，符合用户预期

### 方案二：任务完成后清空

在 `showResult()` 方法中，当任务完成显示结果时清空上传状态。

**缺点**：
- 用户在任务处理期间无法上传新文件
- 不符合"可以并行处理"的预期

### 推荐方案

采用 **方案一**，在提交成功后立即清空上传状态。

## 修改文件清单

| 文件路径 | 修改内容 |
|---------|---------|
| `frontend-new/js/pages/upload.js` | 在 `submitScreening()` 成功分支中添加清空逻辑 |

## 测试验证

1. 上传一个或多个简历文件
2. 点击"开始筛选"
3. 验证：
   - 文件列表区域消失
   - 上传区域重新显示
   - 可以继续上传新文件
   - 进度显示正常
   - 任务结果正常显示

## 风险评估

- **风险等级**：低
- **影响范围**：仅影响上传页面 UI 状态
- **回滚方案**：删除新增的清空代码即可恢复
