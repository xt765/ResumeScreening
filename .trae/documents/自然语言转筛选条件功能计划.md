# 自然语言转筛选条件功能计划

## 需求概述

在筛选条件页面（`http://localhost:3000/#/conditions`）新增功能：
- 用户输入自然语言描述筛选需求
- LLM 自动解析并转换为结构化筛选条件
- 自动填充表单，用户可以修改后确认保存

## 功能设计

### 用户交互流程

```
用户点击"智能创建" → 输入自然语言描述 → LLM 解析 → 自动填充表单 → 用户修改/确认 → 保存
```

### UI 设计

在"新增条件"按钮旁边添加"智能创建"按钮：

```
┌─────────────────────────────────────────────────────────┐
│ 筛选条件                                                │
├─────────────────────────────────────────────────────────┤
│ [搜索框...]                    [智能创建] [新增条件]    │
└─────────────────────────────────────────────────────────┘
```

**第一步：输入自然语言**

```
┌─────────────────────────────────────────────────────────┐
│ 智能创建筛选条件                                  [×]   │
├─────────────────────────────────────────────────────────┤
│ 请用自然语言描述您的筛选需求：                          │
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 例如：需要本科及以上学历，3年以上工作经验，         │ │
│ │ 掌握 Python 和 Java，最好是 985 院校毕业的          │ │
│ │ 候选人                                               │ │
│ │                                                     │ │
│ │                                                     │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│                              [取消] [解析并生成]        │
└─────────────────────────────────────────────────────────┘
```

**第二步：解析成功后显示可编辑表单**

```
┌─────────────────────────────────────────────────────────┐
│ 智能创建筛选条件                                  [×]   │
├─────────────────────────────────────────────────────────┤
│ ✓ 解析成功！您可以修改以下条件后保存：                  │
│                                                         │
│ 条件名称：[高级开发工程师筛选条件        ]              │
│ 条件描述：[本科及以上，3年经验，Python/Java]            │
│                                                         │
│ 学历要求：   [本科          ▼]                          │
│ 工作年限：   [3             ] 年                        │
│ 学校层次：   [顶尖院校（985/C9） ▼]                     │
│ 启用状态：   [启用          ▼]                          │
│                                                         │
│ 技能要求：                                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [Python ×] [Java ×] [输入技能后按回车添加]          │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 专业要求：                                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [输入专业后按回车添加]                              │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│                    [重新输入] [确认保存]                │
└─────────────────────────────────────────────────────────┘
```

**关键特性**：
- 解析成功后，直接复用现有的条件表单组件
- 所有字段都可以编辑修改
- 用户可以添加/删除技能和专业标签
- 点击"重新输入"返回第一步重新描述
- 点击"确认保存"直接提交创建

## 技术实现

### 1. 后端 API

新增接口：`POST /api/v1/conditions/parse-natural-language`

**请求**：
```json
{
  "text": "需要本科及以上学历，3年以上工作经验，掌握 Python 和 Java，最好是 985 院校毕业"
}
```

**响应**：
```json
{
  "success": true,
  "data": {
    "name": "高级开发工程师筛选条件",
    "description": "本科及以上学历，3年以上工作经验，掌握 Python 和 Java，985 院校优先",
    "config": {
      "education_level": "bachelor",
      "experience_years": 3,
      "school_tier": "top",
      "skills": ["Python", "Java"],
      "major": []
    }
  }
}
```

### 2. LLM Prompt 设计

```
你是一个简历筛选条件解析助手。请将用户的自然语言描述转换为结构化的筛选条件。

用户输入：{user_input}

请提取以下信息（如果用户描述中包含）：
1. 学历要求：doctor(博士)/master(硕士)/bachelor(本科)/college(大专)/high_school(高中及以下)
2. 工作年限：最低工作年限（数字）
3. 学校层次：top(985/C9)/key(211)/ordinary(普通)/overseas(海外)
4. 技能要求：技能名称列表
5. 专业要求：专业名称列表
6. 条件名称：根据描述自动生成一个简洁的名称
7. 条件描述：对筛选条件的简要说明

请以 JSON 格式返回结果。
```

### 3. 前端修改

修改 `frontend-new/js/pages/conditions.js`：

1. 添加"智能创建"按钮（与"新增条件"并列）
2. 添加 `showNLPInputModal()` 方法显示自然语言输入对话框
3. 添加 `parseNaturalLanguage()` 方法调用后端 API
4. 添加 `showParsedFormModal()` 方法显示填充好的可编辑表单
   - 复用现有的 `renderConditionForm()` 方法
   - 预填充解析结果
   - 添加"重新输入"按钮
5. 用户修改后点击"确认保存"直接提交创建

### 4. 后端服务

创建 `src/services/nlp_parser.py`：

- 使用 LangChain + OpenAI 解析自然语言
- 返回结构化的 ConditionConfig
- 处理异常情况（解析失败、格式错误等）

## 文件修改清单

| 文件 | 修改内容 |
|------|----------|
| `src/api/v1/conditions.py` | 添加自然语言解析接口 |
| `src/services/nlp_parser.py` | 新建 LLM 解析服务 |
| `src/schemas/condition.py` | 添加 NLP 解析请求模型 |
| `frontend-new/js/api.js` | 添加 NLP 解析 API 方法 |
| `frontend-new/js/pages/conditions.js` | 添加智能创建功能 |

## 实现步骤

### 步骤 1：后端 Schema
- 添加 `NLParseRequest` 请求模型
- 添加 `NLParseResponse` 响应模型

### 步骤 2：后端服务
- 创建 `src/services/nlp_parser.py`
- 实现 LLM 调用和解析逻辑
- 处理异常情况（解析失败、格式错误等）

### 步骤 3：后端 API
- 在 `conditions.py` 添加解析接口
- 调用 NLP 解析服务

### 步骤 4：前端 API
- 在 `api.js` 添加 `conditionsApi.parseNaturalLanguage()` 方法

### 步骤 5：前端页面
- 添加"智能创建"按钮
- 实现自然语言输入对话框
- 解析成功后显示可编辑表单（复用现有表单组件）
- 用户修改后确认保存

### 步骤 6：测试验证
- 测试各种自然语言输入
- 验证解析准确性
- 测试用户修改和保存流程

## 示例输入输出

### 示例 1
**输入**：需要硕士学历，5年以上工作经验，会 Python 和机器学习

**输出**：
```json
{
  "name": "机器学习工程师筛选条件",
  "description": "硕士学历，5年以上工作经验，掌握 Python 和机器学习",
  "config": {
    "education_level": "master",
    "experience_years": 5,
    "skills": ["Python", "机器学习"]
  }
}
```

### 示例 2
**输入**：本科毕业，最好是 211 学校，会 Java 开发

**输出**：
```json
{
  "name": "Java 开发工程师筛选条件",
  "description": "本科学历，211 院校优先，掌握 Java",
  "config": {
    "education_level": "bachelor",
    "school_tier": "key",
    "skills": ["Java"]
  }
}
```

### 示例 3
**输入**：博士学历，有深度学习经验，发表过论文

**输出**：
```json
{
  "name": "算法研究员筛选条件",
  "description": "博士学历，有深度学习和论文发表经验",
  "config": {
    "education_level": "doctor",
    "skills": ["深度学习", "论文发表"]
  }
}
```

## 预估工作量

- 后端修改：约 100 行代码
- 前端修改：约 150 行代码
- 测试验证：功能测试
