# 数据分析页面优化设计计划

## 一、需求分析

### 1.1 核心需求
1. **数据分析范围调整**：将分析对象从现有数据库统计数据变更为RAG智能查询系统生成的结果数据
2. **页面布局优化**：重新设计页面布局，提升信息层次和视觉流畅度
3. **配色方案优化**：建立专业、现代的配色体系，提升视觉美观度
4. **用户体验提升**：优化交互流程，确保界面达到专业设计水准

### 1.2 当前问题分析

#### 数据分析范围问题
- 当前统计图表基于数据库全量数据（人才总数、筛选状态分布、工作流状态分布）
- 与RAG智能查询结果无关联，用户无法看到查询结果的分析统计
- 缺少对查询结果的多维度分析（学历分布、技能分布、经验分布等）

#### 页面布局问题
- 统计概览与RAG查询结果分离，信息流不连贯
- 图表区域与查询结果区域布局不够紧凑
- 缺少对查询结果的动态统计展示

#### 配色方案问题
- 当前使用基础蓝绿配色，缺乏品牌识别度
- 图表颜色与整体风格不够协调
- 缺少深色模式支持

---

## 二、设计方案

### 2.1 数据分析范围重构

#### 新的分析数据流
```
用户输入查询 → RAG智能查询 → 返回结果数据
                                    ↓
                           结果数据分析引擎
                                    ↓
                    ┌──────────────┼──────────────┐
                    ↓              ↓              ↓
              学历分布分析    技能分布分析    经验分布分析
                    ↓              ↓              ↓
              动态图表渲染    动态图表渲染    动态图表渲染
```

#### 新增分析维度
| 维度 | 图表类型 | 数据来源 |
|------|----------|----------|
| 学历分布 | 柱状图 | 查询结果的metadata.education_level |
| 技能分布 | 词云/柱状图 | 查询结果的metadata.skills |
| 工作经验分布 | 柱状图 | 查询结果的metadata.work_years |
| 相似度分布 | 直方图 | 查询结果的similarity_score |
| 学校分布 | 柱状图 | 查询结果的metadata.school |

### 2.2 页面布局重构

#### 新布局结构
```
┌─────────────────────────────────────────────────────────────────────────┐
│                          页面标题 + 描述                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    RAG 智能查询区域                                │  │
│  │  ┌─────────────────────────────────────────────────────────────┐ │  │
│  │  │  查询输入框 + 高级筛选选项                                    │ │  │
│  │  └─────────────────────────────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    分析结论卡片                                   │  │
│  │  （LLM生成的智能分析结论，支持Markdown渲染）                       │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    查询结果统计仪表板                              │  │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │  │
│  │  │  匹配人数   │ │  平均相似度  │ │  学历分布   │ │  经验分布   │ │  │
│  │  │   [数字]    │ │   [百分比]   │ │   [图表]    │ │   [图表]    │ │  │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    候选人列表                                     │  │
│  │  （可排序、可筛选、支持详情查看）                                  │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.3 配色方案设计

#### 主色调体系
```css
/* 品牌主色 - 科技蓝 */
--primary-50: #eff6ff;
--primary-100: #dbeafe;
--primary-200: #bfdbfe;
--primary-300: #93c5fd;
--primary-400: #60a5fa;
--primary-500: #3b82f6;  /* 主色 */
--primary-600: #2563eb;
--primary-700: #1d4ed8;

/* 成功色 - 翡翠绿 */
--success-50: #ecfdf5;
--success-500: #10b981;
--success-600: #059669;

/* 警告色 - 琥珀黄 */
--warning-50: #fffbeb;
--warning-500: #f59e0b;
--warning-600: #d97706;

/* 危险色 - 红宝石 */
--danger-50: #fef2f2;
--danger-500: #ef4444;
--danger-600: #dc2626;

/* 中性色 */
--neutral-50: #fafafa;
--neutral-100: #f4f4f5;
--neutral-200: #e4e4e7;
--neutral-800: #27272a;
--neutral-900: #18181b;
```

#### 图表配色
```javascript
// 学历分布配色
const educationColors = {
  'doctor': '#7c3aed',    // 紫色 - 博士
  'master': '#3b82f6',    // 蓝色 - 硕士
  'bachelor': '#10b981',  // 绿色 - 本科
  'college': '#f59e0b',   // 黄色 - 大专
  'high_school': '#6b7280' // 灰色 - 高中
};

// 相似度热力配色
const similarityGradient = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6'];
```

---

## 三、技术实现方案

### 3.1 后端扩展

#### 新增API端点
```python
@router.post("/query-with-analytics")
async def rag_query_with_analytics(request: QueryRequest) -> APIResponse[RAGAnalyticsResponse]:
    """执行RAG查询并返回分析统计数据。"""
    # 1. 执行RAG查询
    # 2. 分析查询结果
    # 3. 生成统计图表数据
    # 4. 返回完整响应
```

#### 新增响应模型
```python
class QueryResultAnalytics(BaseModel):
    """查询结果分析统计。"""
    total_count: int
    avg_similarity: float
    by_education: dict[str, int]
    by_work_years_range: dict[str, int]
    top_skills: list[dict[str, Any]]
    top_schools: list[dict[str, Any]]
    similarity_distribution: list[dict[str, Any]]


class RAGAnalyticsResponse(BaseModel):
    """RAG查询分析响应。"""
    answer: str
    sources: list[QueryResult]
    analytics: QueryResultAnalytics
    elapsed_time_ms: int
    query_id: str
```

### 3.2 前端重构

#### 核心组件
1. **QueryPanel** - 查询输入面板（支持高级筛选）
2. **AnalysisConclusion** - 分析结论展示（Markdown渲染）
3. **AnalyticsDashboard** - 统计仪表板（动态图表）
4. **CandidateList** - 候选人列表（可排序、可筛选）

#### 图表组件
1. **EducationBarChart** - 学历分布柱状图
2. **SkillsCloudChart** - 技能词云图
3. **ExperienceBarChart** - 经验分布柱状图
4. **SimilarityHistogram** - 相似度分布直方图

---

## 四、实施计划

### 4.1 任务分解

| 阶段 | 任务 | 优先级 | 负责方 |
|------|------|--------|--------|
| **阶段一** | 后端API扩展 | P0 | 主Agent |
| | 1.1 新增查询结果分析API | P0 | 主Agent |
| | 1.2 实现分析统计逻辑 | P0 | 主Agent |
| | 1.3 代码检查（ruff + basepyright） | P0 | 主Agent |
| **阶段二** | 前端页面重构 | P0 | 前端大师 |
| | 2.1 页面布局重构 | P0 | 前端大师 |
| | 2.2 配色方案实施 | P0 | 前端大师 |
| | 2.3 图表组件开发 | P0 | 前端大师 |
| | 2.4 交互优化 | P1 | 前端大师 |
| **阶段三** | 测试与验证 | P0 | 主Agent |
| | 3.1 Chrome DevTools MCP测试 | P0 | 主Agent |
| | 3.2 功能验证 | P0 | 主Agent |
| | 3.3 性能优化 | P1 | 主Agent |

### 4.2 协作流程

1. **主Agent** 负责后端API扩展、数据分析逻辑和代码检查
2. **前端大师** 负责前端页面布局、配色和组件开发
3. 两者并行工作，通过API接口对接

### 4.3 质量保障工具

#### 代码检查
- **ruff**：Python代码格式化和lint检查
  ```bash
  uv run ruff check src/api/v1/analysis.py
  uv run ruff format src/api/v1/analysis.py
  ```
- **basepyright**：Python类型检查
  ```bash
  uv run basepyright src/api/v1/analysis.py
  ```

#### 前端测试
- **Chrome DevTools MCP**：通过MCP工具进行前端功能测试
  - 页面导航和快照
  - 表单交互测试
  - 图表渲染验证
  - 网络请求监控

---

## 五、交付成果

### 5.1 后端交付
- [ ] `src/api/v1/analysis.py` - 新增查询分析API
- [ ] 新增响应模型定义
- [ ] 分析统计逻辑实现

### 5.2 前端交付
- [ ] 页面布局重构
- [ ] 配色方案实施
- [ ] 图表组件开发
- [ ] 交互优化

### 5.3 文档交付
- [ ] API文档更新
- [ ] 用户操作指南

---

## 六、附录

### 附录A：API接口设计

#### POST /api/v1/analysis/query-with-analytics

**请求体**：
```json
{
  "query": "有3年以上Python开发经验的候选人",
  "top_k": 10,
  "filters": {
    "education_level": "master",
    "min_work_years": 3
  }
}
```

**响应体**：
```json
{
  "success": true,
  "data": {
    "answer": "根据查询结果分析...",
    "sources": [...],
    "analytics": {
      "total_count": 10,
      "avg_similarity": 0.85,
      "by_education": {
        "master": 5,
        "bachelor": 3,
        "doctor": 2
      },
      "by_work_years_range": {
        "0-3": 2,
        "3-5": 4,
        "5-10": 3,
        "10+": 1
      },
      "top_skills": [
        {"name": "Python", "count": 8},
        {"name": "Java", "count": 5}
      ],
      "top_schools": [
        {"name": "清华大学", "count": 3}
      ],
      "similarity_distribution": [...]
    },
    "elapsed_time_ms": 1234,
    "query_id": "abc123"
  }
}
```

### 附录B：前端组件结构

```
AnalysisPage
├── QueryPanel
│   ├── QueryInput
│   ├── AdvancedFilters
│   └── QueryButton
├── AnalysisConclusion
│   └── MarkdownRenderer
├── AnalyticsDashboard
│   ├── SummaryCards
│   ├── EducationChart
│   ├── SkillsChart
│   ├── ExperienceChart
│   └── SimilarityChart
└── CandidateList
    ├── SortControls
    ├── FilterControls
    └── CandidateCards
```
