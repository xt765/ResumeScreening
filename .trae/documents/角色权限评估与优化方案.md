# 角色权限评估与优化方案

## 一、项目定位分析

### 1.1 项目背景

根据项目文档 `人才简历智能筛选与管理系统.docx`：

> 本项目旨在构建一个智能化人才简历筛选与管理平台，实现对简历的自动化解析、智能筛选、信息提取、向量化存储与多维度查询分析，提升人才筛选的效率和精准度。

### 1.2 目标用户

| 用户类型 | 描述 |
|---------|------|
| HR / 招聘人员 | 主要使用者，负责简历筛选、人才管理 |
| 人才管理部门 | 管理层，查看统计数据、决策支持 |
| 校园招聘团队 | 季节性使用者，批量处理校招简历 |

### 1.3 核心功能模块

1. **人才简历基础管理** - 筛选条件的新增、修改、删除、查询
2. **简历解析与存储** - PDF 解析、图片存储至 MinIO
3. **智能信息提取与入库** - 大模型提取实体信息、入库
4. **向量化存储与检索** - LangChain + ChromaDB
5. **多维度数据分析** - RAG 查询、统计图表

---

## 二、当前角色权限实现分析

### 2.1 角色定义

| 角色 | 代码 | 设计初衷 |
|------|------|----------|
| 管理员 | `admin` | 可创建/管理用户、查看所有数据 |
| HR 用户 | `hr` | 可管理筛选条件、上传简历、查看人才 |
| 访客 | `viewer` | 仅可查看数据，不可修改 |

### 2.2 后端 API 权限控制

**已实现权限控制的 API：**

| API 端点 | 方法 | 权限要求 | 说明 |
|----------|------|----------|------|
| `/api/v1/users` | GET/POST | `admin` | 用户管理 |
| `/api/v1/users/{id}` | PUT/DELETE | `admin` | 用户管理 |
| `/api/v1/users/{id}/reset-password` | POST | `admin` | 用户管理 |

**未实现权限控制的 API：**

| API 端点 | 方法 | 当前状态 |
|----------|------|----------|
| `/api/v1/conditions` | GET/POST/PUT/DELETE | 无角色限制 |
| `/api/v1/talents` | GET/POST/PUT/DELETE | 无角色限制 |
| `/api/v1/analysis` | GET/POST | 无角色限制 |
| `/api/v1/monitor` | GET | 无角色限制 |
| `/api/v1/auth` | GET/POST | 无角色限制 |

### 2.3 前端页面权限控制

**已实现权限控制的页面：**

| 页面 | 权限要求 | 代码位置 |
|------|----------|----------|
| 用户管理 (`users`) | `admin` | `app.js:137` - `requireRole: 'admin'` |

**未实现权限控制的页面：**

| 页面 | 当前状态 |
|------|----------|
| 系统概览 | 无角色限制 |
| 筛选条件 | 无角色限制 |
| 简历上传 | 无角色限制 |
| 人才信息 | 无角色限制 |
| 数据分析 | 无角色限制 |
| 系统监控 | 无角色限制 |

### 2.4 测试验证结果

通过 MCP 测试验证：

| API 端点 | Admin | HR | Viewer |
|----------|:-----:|:--:|:------:|
| `/api/v1/auth/me` | ✅ 200 | ✅ 200 | ✅ 200 |
| `/api/v1/conditions` (GET) | ✅ 200 | ✅ 200 | ✅ 200 |
| `/api/v1/conditions` (POST) | ✅ 201 | ✅ 201 | ✅ 201 |
| `/api/v1/talents` (GET) | ✅ 200 | ✅ 200 | ✅ 200 |
| `/api/v1/talents/tasks` (GET) | ✅ 200 | ✅ 200 | ✅ 200 |
| `/api/v1/analysis/statistics` | ✅ 200 | ✅ 200 | ✅ 200 |
| `/api/v1/monitor/health` | ✅ 200 | ✅ 200 | ✅ 200 |
| `/api/v1/monitor/metrics` | ✅ 200 | ✅ 200 | ✅ 200 |
| `/api/v1/monitor/logs` | ✅ 200 | ✅ 200 | ✅ 200 |
| `/api/v1/users` (GET) | ✅ 200 | ❌ 403 | ❌ 403 |
| `/api/v1/users` (POST) | ✅ 200 | ❌ 403 | ❌ 403 |

---

## 三、问题诊断

### 3.1 核心问题：HR 和 Viewer 权限完全相同

**结论：当前实现中，HR 和 Viewer 角色权限没有区别。**

两者都能：
- ✅ 查看所有业务数据
- ✅ 新增/修改/删除筛选条件
- ✅ 上传简历、管理人才
- ✅ 执行数据分析、RAG 查询
- ✅ 查看系统监控

唯一区别：
- ❌ 都不能访问用户管理（仅 Admin 可访问）

### 3.2 与设计初衷不符

根据 `登录注册功能实施方案.md` 中的角色定义：

> * `hr` - HR 用户：可管理筛选条件、上传简历、查看人才
> * `viewer` - 访客：仅可查看数据，不可修改

**当前实现完全违背了 Viewer 角色的设计初衷。**

---

## 四、方案评估

### 方案 A：删除 Viewer 角色

#### 优点

1. **符合项目定位**
   - 企业内部系统，所有使用者都是 HR/招聘相关人员
   - 需要操作权限，不存在"只看不改"的场景

2. **简化系统复杂度**
   - 减少角色管理复杂度
   - 避免用户对角色功能的困惑

3. **符合实际业务场景**
   - HR 需要筛选简历、上传文件
   - 人才管理部门需要查看统计、导出数据
   - 校园招聘团队需要批量处理简历

4. **文档支持**
   - 项目答辩文档中未提及"访客"角色
   - 需求文档中目标用户明确为 HR 相关人员

#### 缺点

1. **需要数据迁移**
   - 已创建的 Viewer 用户需要转换角色

2. **代码修改**
   - 需要修改角色枚举、前端选项等

### 方案 B：修复 Viewer 权限（实现只读）

#### 优点

1. **保留设计灵活性**
   - 未来可能有"只读"需求场景

2. **符合原始设计**
   - 实现文档中定义的角色权限

#### 缺点

1. **业务场景不明确**
   - 企业内部系统中，谁需要"只读"权限？
   - HR 必须操作，管理层也需要导出数据

2. **实现复杂度高**
   - 需要为每个 API 添加权限检查
   - 前端需要隐藏/禁用操作按钮
   - 测试工作量翻倍

3. **用户体验问题**
   - Viewer 用户看到按钮却不能操作，体验差
   - 需要大量前端条件判断

---

## 五、推荐方案

### 推荐：方案 A - 删除 Viewer 角色

#### 理由

1. **项目定位明确**
   - 企业内部人才筛选系统
   - 目标用户都是需要操作权限的 HR 人员

2. **业务场景分析**
   - HR：需要筛选简历、上传文件、管理人才 → 需要写权限
   - 人才管理部门：需要查看统计、导出数据 → 需要写权限（导出）
   - 校园招聘团队：需要批量处理 → 需要写权限
   - **不存在只读场景**

3. **文档依据**
   - 答辩文档中考核内容都是操作功能
   - 需求文档中未定义"访客"使用场景

4. **简化系统**
   - 减少维护成本
   - 避免用户困惑

---

## 六、实施计划

### 6.1 后端修改

1. **修改角色枚举** (`src/models/user.py`)
   - 删除 `VIEWER = "viewer"`

2. **修改 Schema** (`src/schemas/user.py`)
   - 删除 Viewer 相关选项

3. **数据迁移**
   - 将现有 Viewer 用户转换为 HR 角色

### 6.2 前端修改

1. **修改用户创建表单** (`frontend-new/js/pages/users.js`)
   - 删除"访客"选项

2. **修改用户编辑表单**
   - 删除"访客"选项

3. **修改角色筛选下拉框**
   - 删除"访客"选项

### 6.3 文档更新

1. 更新 `登录注册功能实施方案.md`
2. 更新角色说明文档

---

## 七、风险评估

| 风险 | 级别 | 缓解措施 |
|------|------|----------|
| 现有 Viewer 用户数据迁移 | 低 | 执行 SQL 更新即可 |
| 代码遗漏 | 低 | 全面测试验证 |
| 未来需求变化 | 低 | 可随时添加新角色 |

---

## 八、结论

**建议删除 Viewer（访客）角色**，理由如下：

1. 当前 HR 和 Viewer 权限完全相同，Viewer 角色形同虚设
2. 项目定位为企业内部系统，所有用户都需要操作权限
3. 业务场景中不存在"只读"需求
4. 删除后可简化系统复杂度，减少维护成本
